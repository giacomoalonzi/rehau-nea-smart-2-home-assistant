================================================================================
INSTALLATION DATA PARSER V2 - QUICK REFERENCE GUIDE
================================================================================

OVERVIEW
--------
Parser V2 provides an improved hierarchical structure for REHAU installation data:

  IUser -> IInstall[] -> IGroup[] -> IZone[] -> IChannel[]
                      -> IController[]
                      -> IMixedCircuit[]

KEY IMPROVEMENTS OVER V1
------------------------
✓ User-level data (email, roles, geofencing)
✓ Multiple installations support
✓ Zone controller references (zones know which controller manages them)
✓ User settings (party mode, temperature units, etc.)
✓ Installer settings (software version, signal power, etc.)
✓ Digital I/O in mixed circuits
✓ Better type safety with strict interfaces
✓ Cleaner separation of concerns


USAGE
-----

1. Basic Usage:
   ```typescript
   import { InstallationDataParserV2 } from './parsers/installation-data-parser-v2';
   
   const parser = new InstallationDataParserV2();
   const result = parser.parse(apiResponse);
   
   console.log(`User: ${result.email}`);
   result.installs.forEach(install => {
     console.log(`Installation: ${install.name}`);
   });
   ```

2. Filter by Installation:
   ```typescript
   const result = parser.parse(apiResponse, 'installation-unique-id');
   ```

3. Parse from JSON file:
   ```typescript
   const result = parser.parseFromJson(jsonString);
   ```

4. Get summary:
   ```typescript
   const summary = parser.getSummary(result);
   console.log(summary);
   ```


CLI COMMANDS
------------

1. Parse and show summary:
   npm run parseInstallationV2 -- installationdata.json --summary

2. Parse and show JSON (with raw data):
   npm run parseInstallationV2 -- installationdata.json

3. Parse and show only typed properties (exclude raw):
   npm run parseInstallationV2 -- installationdata.json --typed

4. Filter by installation:
   npm run parseInstallationV2 -- installationdata.json --unique abc123

5. Compare V1 and V2 parsers:
   npm run compareParsers -- installationdata.json

Note: The --typed flag removes all 'raw' fields from the output, showing only
      the typed/structured properties. Useful for cleaner output and smaller
      file sizes when you don't need the original API data.


DATA STRUCTURE
--------------

IUser (Top Level)
├─ id: string
├─ email: string
├─ roles: string[]
├─ geofencing: IGeofencing
└─ installs: IInstall[]

IInstall (Installation)
├─ id, unique, name, address, version
├─ connectionState, timezone
├─ outsideTemperature, outsideTemperatureFiltered
├─ operationMode: { heating, cooling, manual }
├─ groups: IGroup[]
├─ controllers: IController[]
├─ mixedCircuits: IMixedCircuit[]
├─ userSettings: IUserSettings
└─ installerSettings: IInstallerSettings

IGroup (Group)
├─ id: string
├─ name: string
└─ zones: IZone[]

IZone (Zone)
├─ id, number, name
├─ channels: IChannel[]
└─ controllerRef: string (references controller unique ID)

IChannel (Thermostat/Sensor)
├─ id, channelZone, controllerNumber
├─ currentTemperature, setpointTemperature
├─ humidity, dewpoint
├─ openWindow, lowBattery
├─ mode, demand
├─ config: { heating, cooling, ringActivation, locked }
└─ setpoints: { heatingNormal, heatingReduced, ... }

IController (Controller)
├─ number: number
├─ unique: string
└─ zoneRefs: string[] (array of zone IDs)

IMixedCircuit (Heating/Cooling Circuit)
├─ number: number
├─ setpoint, supply, return (temperatures)
├─ opening: number (valve %)
├─ pumps: IPump[]
├─ digitalInputs: IDi[]
└─ digitalOutputs: IDo[]


MIGRATION FROM V1 TO V2
------------------------

Old V1 code:
  const parser = new InstallationDataParser();
  const install = parser.parse(response);
  console.log(install.name);
  install.groups.forEach(group => { ... });

New V2 code:
  const parser = new InstallationDataParserV2();
  const userData = parser.parse(response);
  userData.installs.forEach(install => {
    console.log(install.name);
    install.groups.forEach(group => { ... });
  });

Key difference: V2 returns user data with multiple installations,
                V1 returns single installation directly.


HOME ASSISTANT INTEGRATION
---------------------------

Recommended device structure:

Device: "REHAU {install.name}"
  identifiers: ["rehau_{install.unique}"]
  
  Entities:
    - Outside Temperature (sensor)
    - System Mode Control (climate)
    - Connection Status (binary_sensor)
    
    For each zone:
      - Climate Control (thermostat)
      - Temperature Sensor
      - Humidity Sensor
      - Open Window Detection
      - Low Battery Warning
      - Heating Demand
    
    For each mixed circuit:
      - Supply Temperature
      - Return Temperature
      - Valve Opening
      - Pump Status (per pump)


BACKWARDS COMPATIBILITY
------------------------

The old parser (InstallationDataParser) remains unchanged and fully functional.
Both parsers can coexist in the same project.

To switch:
  - Import from 'installation-data-parser-v2' instead of 'installation-data-parser'
  - Update code to handle user-level structure (userData.installs[0] instead of direct install)
  - Enjoy new features!


FILES
-----
- installation-data-parser-v2.ts       Main parser implementation
- cli-installation-data-v2.ts          CLI tool for testing
- compare-parsers.ts                   Comparison tool
- index.ts                             Exports (updated)


TESTING
-------

Run comparison to verify both parsers produce same core data:
  npm run compareParsers -- installationdata.json

Expected output:
  ✓ Installation name matches: true
  ✓ Groups count matches: true
  ✓ Controllers count matches: true
  ✓ Mixed circuits count matches: true
  ✓ Zones count matches: true
  ✓ Channels count matches: true


NEXT STEPS
----------

1. Test parser with your data:
   npm run parseInstallationV2 -- /path/to/your/data.json --summary

2. Compare with V1:
   npm run compareParsers -- /path/to/your/data.json

3. Update climate-controller.ts to use V2 (when ready):
   - Import InstallationDataParserV2
   - Update initialization to handle IUser structure
   - Access install data via userData.installs[]

4. Implement Home Assistant device structure:
   - One device per installation
   - All entities grouped under installation device
   - Use install.unique as device identifier


SUPPORT
-------

For questions or issues with the parser, check:
  - Type definitions in installation-data-parser-v2.ts
  - Example usage in cli-installation-data-v2.ts
  - Comparison output from compare-parsers.ts

================================================================================
